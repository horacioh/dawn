{% comment %}
  Renders a recipe card for a given article with customizable settings.

  Accepts:
  - article: {Object} Article object
  - blog: {Object} Blog object
  - media_aspect_ratio: {String} The setting changes the aspect ratio of the article image
  - media_height: {String} The setting changes the height of the article image
  - show_excerpt: {Boolean} Show recipe excerpt
  - show_date: {Boolean} Show publish date
  - show_tags: {Boolean} Show recipe tags
  - lazy_load: {Boolean} Image should be lazy loaded. Default: true (optional)

  Usage:
  {% render 'recipe-card', article: article, blog: blog, show_excerpt: true %}
{% endcomment %}

{%- if article and article != empty -%}
  {%- liquid
    assign ratio = 1
    if media_aspect_ratio != null
      assign ratio = media_aspect_ratio
    endif

    case media_aspect_ratio
      when 'portrait'
        assign ratio = 0.8
      when 'square'
        assign ratio = 1
      when 'landscape'
        assign ratio = 1.3
      else
        if article.image
          assign ratio = article.image.aspect_ratio
        endif
    endcase
  -%}

  <article class="recipe-card-wrapper">
    <div
      class="
        recipe-card card--{{ settings.blog_card_style }}
        {% if media_height and media_height != 'adapt' %} recipe-card__image--{{ media_height }}{% endif %}
        {% if article.image %} card--media{% else %} card--text{% endif %}
        {% if settings.blog_card_style == 'card' %} color-{{ settings.blog_card_color_scheme }} gradient{% endif %}
      "
    >
      <a href="{{ article.url }}" class="recipe-card__link">
        {%- if article.image -%}
          <div class="recipe-card__image-wrapper">
            <div
              class="recipe-card__image media media--hover-effect{% if media_height != 'adapt' %} media--{{ media_height }}{% endif %}"
              {% if media_height == 'adapt' %}
                style="padding-bottom: {{ 1 | divided_by: ratio | times: 100 }}%;"
              {% endif %}
            >
              {% comment %}theme-check-disable ImgLazyLoading{% endcomment %}
              <img
                srcset="
                  {%- if article.image.width >= 300 -%}{{ article.image | image_url: width: 300 }} 300w,{%- endif -%}
                  {%- if article.image.width >= 400 -%}{{ article.image | image_url: width: 400 }} 400w,{%- endif -%}
                  {%- if article.image.width >= 600 -%}{{ article.image | image_url: width: 600 }} 600w,{%- endif -%}
                  {%- if article.image.width >= 800 -%}{{ article.image | image_url: width: 800 }} 800w,{%- endif -%}
                  {{ article.image | image_url }} {{ article.image.width }}w
                "
                src="{{ article.image | image_url: width: 400 }}"
                sizes="(min-width: 1200px) 300px, (min-width: 750px) calc((100vw - 10rem) / 3), calc((100vw - 3rem) / 2)"
                alt="{{ article.image.alt | default: article.title | escape }}"
                class="motion-reduce"
                {% unless lazy_load == false %}
                  loading="lazy"
                {% endunless %}
                width="{{ article.image.width }}"
                height="{{ article.image.height }}"
              >
              {% comment %}theme-check-enable ImgLazyLoading{% endcomment %}
            </div>
          </div>
        {%- endif -%}

        <div class="recipe-card__content">
          <div class="recipe-card__header">
            <h3 class="recipe-card__title h4">
              {{ article.title | truncate: 60 | escape }}
            </h3>

            {%- if show_date -%}
              <time
                class="recipe-card__date caption-with-letter-spacing"
                datetime="{{ article.published_at | date: '%Y-%m-%d' }}"
              >
                {{ article.published_at | time_tag: format: 'date' }}
              </time>
            {%- endif -%}
          </div>

          {%- if show_excerpt and article.excerpt.size > 0 or article.content.size > 0 -%}
            <div class="recipe-card__excerpt rte">
              {%- if article.excerpt.size > 0 -%}
                {{ article.excerpt | strip_html | truncatewords: 20 }}
              {%- else -%}
                {{ article.content | strip_html | truncatewords: 20 }}
              {%- endif -%}
            </div>
          {%- endif -%}

          {%- if show_tags and article.tags.size > 0 -%}
            <div class="recipe-card__tags">
              {%- assign displayed_tags = 0 -%}
              {%- for tag in article.tags -%}
                {%- if displayed_tags < 3 -%}
                  {%- unless tag contains 'category:' or tag contains 'flavor:' -%}
                    <span class="recipe-card__tag badge">{{ tag }}</span>
                    {%- assign displayed_tags = displayed_tags | plus: 1 -%}
                  {%- endunless -%}
                {%- endif -%}
              {%- endfor -%}
            </div>
          {%- endif -%}
        </div>
      </a>
    </div>
  </article>
{%- endif -%}
